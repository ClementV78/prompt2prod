Technique</h1>
<h2 id="poc-openhands-avec-orchestration-multi-llm---v1-simplifiÃ©e">POC
OpenHands avec Orchestration Multi-LLM - v1 SimplifiÃ©e</h2>
<hr />
<p><strong>Version:</strong> 1.0 - Approche DevOps Classique<br />
<strong>Date:</strong> Janvier 2025<br />
<strong>Classification:</strong> POC / Proof of Concept<br />
<strong>Auteur:</strong> Architecture DevOps Team</p>
<hr />
<h2 id="rÃ©sumÃ©-exÃ©cutif">1. RÃ©sumÃ© ExÃ©cutif</h2>
<h3 id="objectif">1.1 Objectif</h3>
<p>Mise en place dâ€™un POC permettant lâ€™automatisation du cycle de
dÃ©veloppement logiciel via IA, depuis lâ€™expression du besoin jusquâ€™au
dÃ©ploiement, avec une approche <strong>DevOps classique (push)</strong>
pour valider rapidement le concept.</p>
<h3 id="principes-directeurs">1.2 Principes directeurs</h3>
<ul>
<li><strong>SimplicitÃ© avant tout</strong> : Approche push
traditionnelle via GitHub Actions</li>
<li><strong>Time to market</strong> : POC fonctionnel en 4 semaines au
lieu de 8</li>
<li><strong>Validation rapide</strong> : Focus sur la valeur de lâ€™IA,
pas sur lâ€™infrastructure</li>
<li><strong>Ã‰volution progressive</strong> : Architecture permettant une
migration GitOps future si pertinent</li>
</ul>
<h3 id="pÃ©rimÃ¨tre-v1">1.3 PÃ©rimÃ¨tre v1</h3>
<ul>
<li><strong>Orchestration IA</strong> : OpenHands pour la coordination
dâ€™agents</li>
<li><strong>Multi-LLM</strong> : Support modÃ¨les locaux (Ollama) et
cloud (OpenRouter)</li>
<li><strong>CI/CD simplifiÃ©</strong> : GitHub Actions avec kubectl
direct</li>
<li><strong>Infrastructure</strong> : K3s mono-cluster</li>
<li><strong>Monitoring</strong> : Basique (logs + mÃ©triques
essentielles)</li>
</ul>
<h3 id="hors-pÃ©rimÃ¨tre-v1-simplifications">1.4 Hors pÃ©rimÃ¨tre v1
(simplifications)</h3>
<ul>
<li>âŒ GitOps/Flux (complexitÃ© inutile pour POC)</li>
<li>âŒ SOPS (secrets GitHub suffisants)</li>
<li>âŒ Multi-environnements (dev/staging/prod)</li>
<li>âŒ Haute disponibilitÃ©</li>
<li>âŒ ObservabilitÃ© avancÃ©e</li>
</ul>
<hr />
<h2 id="architecture-simplifiÃ©e">2. Architecture SimplifiÃ©e</h2>
<h3 id="vue-densemble">2.1 Vue dâ€™ensemble</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Utilisateur                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     OpenHands                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Agent Specification  â€¢ Agent Development       â”‚    â”‚
â”‚  â”‚ â€¢ Agent Testing        â€¢ Agent Documentation     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    GitHub Repository    â”‚
        â”‚  â€¢ Code source          â”‚
        â”‚  â€¢ K8s manifests        â”‚
        â”‚  â€¢ Dockerfile           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   GitHub Actions        â”‚
        â”‚  â€¢ Build â†’ Test â†’ Push  â”‚
        â”‚  â€¢ kubectl apply        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    K3s Cluster                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚               KGateway                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚               â†“               â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Ollama (Local) â”‚  â”‚ OpenRouter Proxy â”‚              â”‚
â”‚  â”‚  â€¢ Llama 3      â”‚  â”‚  â€¢ Claude 3.5    â”‚              â”‚
â”‚  â”‚  â€¢ Mistral      â”‚  â”‚  â€¢ GPT-4         â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="flux-de-travail-simplifiÃ©">2.2 Flux de travail simplifiÃ©</h3>
<pre><code>1. DÃ©veloppeur â†’ Prompt dans OpenHands
2. OpenHands â†’ GÃ©nÃ©ration code + tests + K8s manifests
3. OpenHands â†’ CrÃ©ation PR sur GitHub
4. GitHub Actions â†’ Build &amp; Test automatique
5. Merge PR â†’ DÃ©ploiement automatique via kubectl
6. Application â†’ Running sur K3s</code></pre>
<hr />
<h2 id="stack-technique-allÃ©gÃ©e">3. Stack Technique AllÃ©gÃ©e</h2>
<h3 id="composants-essentiels-uniquement">3.1 Composants essentiels
uniquement</h3>
<table>
<thead>
<tr>
<th>Composant</th>
<th>Version</th>
<th>RÃ´le</th>
<th>ComplexitÃ©</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OpenHands</strong></td>
<td>Latest</td>
<td>Orchestration IA</td>
<td>â­â­â­</td>
</tr>
<tr>
<td><strong>GitHub</strong></td>
<td>-</td>
<td>Source + CI/CD</td>
<td>â­</td>
</tr>
<tr>
<td><strong>GitHub Actions</strong></td>
<td>-</td>
<td>Pipeline push</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>GHCR</strong></td>
<td>-</td>
<td>Registry Docker</td>
<td>â­</td>
</tr>
<tr>
<td><strong>K3s</strong></td>
<td>1.29.x</td>
<td>Kubernetes lÃ©ger</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>KGateway</strong></td>
<td>1.0</td>
<td>Routing LLM</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>Ollama</strong></td>
<td>0.3.x</td>
<td>LLM local</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>OpenRouter</strong></td>
<td>API v1</td>
<td>LLM cloud</td>
<td>â­</td>
</tr>
</tbody>
</table>
<h3 id="composants-diffÃ©rÃ©s-Ã -v2">3.2 Composants diffÃ©rÃ©s Ã  v2</h3>
<table>
<thead>
<tr>
<th>Composant</th>
<th>Raison du report</th>
</tr>
</thead>
<tbody>
<tr>
<td>Flux/ArgoCD</td>
<td>ComplexitÃ© GitOps non nÃ©cessaire</td>
</tr>
<tr>
<td>SOPS</td>
<td>GitHub Secrets suffisants</td>
</tr>
<tr>
<td>Prometheus/Grafana</td>
<td>Monitoring basique suffisant</td>
</tr>
<tr>
<td>Testkube</td>
<td>Tests dans GitHub Actions OK</td>
</tr>
<tr>
<td>Jaeger</td>
<td>Tracing non prioritaire</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="structure-du-projet">4. Structure du Projet</h2>
<h3 id="organisation-des-dossiers">4.1 Organisation des dossiers</h3>
<pre><code>poc-openhands/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml          # Pipeline simple push
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # Code gÃ©nÃ©rÃ© par OpenHands
â”‚   â””â”€â”€ frontend/               # UI si nÃ©cessaire
â”œâ”€â”€ k8s/
â”‚   â”œâ”€â”€ deployment.yaml         # Manifests simples
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ configmap.yaml
â”‚   â””â”€â”€ kgateway-routes.yaml    # Routing LLM
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                   # Tests unitaires gÃ©nÃ©rÃ©s
â”‚   â””â”€â”€ integration/            # Tests d&#39;intÃ©gration
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ Dockerfile              # Image application
â””â”€â”€ README.md                   # Documentation</code></pre>
<h3 id="pipeline-github-actions">4.2 Pipeline GitHub Actions</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and Deploy POC</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">]</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">REGISTRY</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">IMAGE_NAME</span><span class="kw">:</span><span class="at"> ${{ github.repository }}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">build-test-deploy</span><span class="kw">:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">    # 1. Checkout code</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">    # 2. Login to GHCR</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Log in to Container Registry</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v2</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ${{ env.REGISTRY }}</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.actor }}</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">    # 3. Build and push Docker image</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and push Docker image</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }} .</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest .</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        docker push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        docker push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">    # 4. Run tests</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        docker run --rm ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }} npm test</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">    # 5. Deploy to K3s (only on main)</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy to K3s</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.ref == &#39;refs/heads/main&#39; &amp;&amp; github.event_name == &#39;push&#39;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        # Setup kubectl</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        mkdir -p $HOME/.kube</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        echo &quot;${{ secrets.KUBECONFIG }}&quot; | base64 -d &gt; $HOME/.kube/config</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        # Update image tag in deployment</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        sed -i &quot;s|IMAGE_TAG|${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}|g&quot; k8s/deployment.yaml</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        # Apply all manifests</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        kubectl apply -f k8s/</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        # Wait for rollout to complete</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        kubectl rollout status deployment/app -n default --timeout=5m</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        # Show deployment status</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        kubectl get pods -n default</span></code></pre></div>
<hr />
<h2 id="configuration-multi-llm-simplifiÃ©e">5. Configuration Multi-LLM
SimplifiÃ©e</h2>
<h3 id="stratÃ©gie-de-routage">5.1 StratÃ©gie de routage</h3>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>LLM</th>
<th>Mode</th>
<th>Justification</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DonnÃ©es sensibles</strong></td>
<td>Llama 3</td>
<td>Local (Ollama)</td>
<td>ConfidentialitÃ©</td>
</tr>
<tr>
<td><strong>Code complexe</strong></td>
<td>GPT-4</td>
<td>Cloud (OpenRouter)</td>
<td>Performance</td>
</tr>
<tr>
<td><strong>Tests</strong></td>
<td>Mistral</td>
<td>Local (Ollama)</td>
<td>Ã‰conomique</td>
</tr>
<tr>
<td><strong>Documentation</strong></td>
<td>Claude 3.5</td>
<td>Cloud (OpenRouter)</td>
<td>QualitÃ©</td>
</tr>
<tr>
<td><strong>Par dÃ©faut</strong></td>
<td>Mistral</td>
<td>Local (Ollama)</td>
<td>CoÃ»t minimal</td>
</tr>
</tbody>
</table>
<h3 id="configuration-kgateway-minimale">5.2 Configuration KGateway
minimale</h3>
<div class="sourceCode" id="cb5"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> gateway.networking.k8s.io/v1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HTTPRoute</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> llm-router</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">parentRefs</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> kgateway</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">rules</span><span class="kw">:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">  # Route vers Ollama (local)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">matches</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">headers</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> x-llm-mode</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">value</span><span class="kw">:</span><span class="at"> local</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">backendRefs</span><span class="kw">:</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">11434</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">  # Route vers OpenRouter (cloud)</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">matches</span><span class="kw">:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">headers</span><span class="kw">:</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> x-llm-mode</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">value</span><span class="kw">:</span><span class="at"> cloud</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">backendRefs</span><span class="kw">:</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> openrouter-proxy</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">8080</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">  # Default = local</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">backendRefs</span><span class="kw">:</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">11434</span></span></code></pre></div>
<h3 id="dÃ©ploiement-ollama-simple">5.3 DÃ©ploiement Ollama simple</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ollama/ollama:latest</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">11434</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;4Gi&quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2&quot;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;8Gi&quot;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;4&quot;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">volumeMounts</span><span class="kw">:</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> models</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">mountPath</span><span class="kw">:</span><span class="at"> /root/.ollama</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> models</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">emptyDir</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> ollama</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">11434</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">11434</span></span></code></pre></div>
<hr />
<h2 id="gestion-des-secrets-approche-simple">6. Gestion des Secrets
(Approche Simple)</h2>
<h3 id="github-secrets-nÃ©cessaires">6.1 GitHub Secrets nÃ©cessaires</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Secrets Ã  configurer dans GitHub (Settings â†’ Secrets)</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">KUBECONFIG</span><span class="kw">:</span><span class="co">        # Config K3s encodÃ©e en base64</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">OPENROUTER_KEY</span><span class="kw">:</span><span class="co">    # ClÃ© API OpenRouter</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="co">      # Auto-gÃ©nÃ©rÃ© pour GHCR</span></span></code></pre></div>
<h3 id="configmap-pour-configuration-non-sensible">6.2 ConfigMap pour
configuration non-sensible</h3>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> llm-config</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">default_model</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;mistral&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ollama_models</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;llama3,mistral,codellama&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">max_retries</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">timeout_seconds</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;30&quot;</span></span></code></pre></div>
<hr />
<h2 id="installation-et-dÃ©marrage-rapide">7. Installation et DÃ©marrage
Rapide</h2>
<h3 id="prÃ©requis">7.1 PrÃ©requis</h3>
<ul>
<li>VM ou serveur avec 8GB RAM minimum</li>
<li>Ubuntu 22.04 ou similaire</li>
<li>AccÃ¨s GitHub avec repo crÃ©Ã©</li>
<li>Compte OpenRouter (optionnel pour v1)</li>
</ul>
<h3 id="setup-en-30-minutes">7.2 Setup en 30 minutes</h3>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Installer K3s (5 min)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sfL</span> https://get.k3s.io <span class="kw">|</span> <span class="fu">sh</span> <span class="at">-</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod 644 /etc/rancher/k3s/k3s.yaml</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. RÃ©cupÃ©rer kubeconfig pour GitHub (1 min)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/rancher/k3s/k3s.yaml <span class="kw">|</span> <span class="fu">base64</span> <span class="at">-w</span> 0</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># â†’ Copier dans GitHub Secrets comme KUBECONFIG</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Installer Ollama dans K3s (5 min)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> k8s/ollama-deployment.yaml</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Charger les modÃ¨les (10 min)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> deployment/ollama <span class="at">--</span> ollama pull mistral</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> deployment/ollama <span class="at">--</span> ollama pull llama3</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. DÃ©ployer KGateway (5 min)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> https://github.com/solo-io/gloo/releases/download/v1.15.0/gloo-gateway.yaml</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> k8s/kgateway-routes.yaml</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Configurer OpenHands (5 min)</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> OPENROUTER_API_KEY=<span class="va">$OPENROUTER_KEY</span> <span class="dt">\</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> LLM_BASE_URL=http://your-k3s-ip:31234 <span class="dt">\</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">-p</span> 3000:3000 <span class="dt">\</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  ghcr.io/all-hands-ai/openhands:latest</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Premier test</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> http://localhost:3000</span></code></pre></div>
<hr />
<h2 id="roadmap-simplifiÃ©e">8. Roadmap SimplifiÃ©e</h2>
<h3 id="phase-1-mvp-semaines-1-2">Phase 1 : MVP (Semaines 1-2) âœ…</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />Setup K3s
basique</label></li>
<li><label><input type="checkbox" checked="" />GitHub + GitHub
Actions</label></li>
<li><label><input type="checkbox" checked="" />Ollama avec 1-2
modÃ¨les</label></li>
<li><label><input type="checkbox" checked="" />Pipeline push
simple</label></li>
<li><label><input type="checkbox" checked="" />Premier dÃ©ploiement
manuel</label></li>
</ul>
<h3 id="phase-2-integration-openhands-semaine-3">Phase 2 : Integration
OpenHands (Semaine 3) ğŸš§</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Configuration OpenHands</label></li>
<li><label><input type="checkbox" />Connection avec GitHub</label></li>
<li><label><input type="checkbox" />Premier code gÃ©nÃ©rÃ©</label></li>
<li><label><input type="checkbox" />PR automatique</label></li>
</ul>
<h3 id="phase-3-multi-llm-semaine-4">Phase 3 : Multi-LLM (Semaine 4)
ğŸ“‹</h3>
<ul class="task-list">
<li><label><input type="checkbox" />KGateway routing</label></li>
<li><label><input type="checkbox" />OpenRouter integration</label></li>
<li><label><input type="checkbox" />Choix local/cloud</label></li>
<li><label><input type="checkbox" />Tests end-to-end</label></li>
</ul>
<h3 id="phase-4-stabilisation-semaine-5">Phase 4 : Stabilisation
(Semaine 5) ğŸ“‹</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Documentation</label></li>
<li><label><input type="checkbox" />MÃ©triques basiques</label></li>
<li><label><input type="checkbox" />Optimisation coÃ»ts</label></li>
<li><label><input type="checkbox" />Demo finale</label></li>
</ul>
<h3 id="Ã©volutions-futures-post-poc">Ã‰volutions futures (Post-POC)</h3>
<ul>
<li>GitOps avec Flux (si volume justifie)</li>
<li>Monitoring avancÃ© (si production)</li>
<li>Multi-environnements (si Ã©quipe grandit)</li>
<li>HA et scaling (si charge augmente)</li>
</ul>
<hr />
<h2 id="mÃ©triques-de-succÃ¨s-simplifiÃ©es">9. MÃ©triques de SuccÃ¨s
SimplifiÃ©es</h2>
<h3 id="kpis-essentiels-uniquement">9.1 KPIs essentiels uniquement</h3>
<table>
<thead>
<tr>
<th>MÃ©trique</th>
<th>Cible v1</th>
<th>Mesure</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Temps setup complet</strong></td>
<td>&lt; 1 jour</td>
<td>ChronomÃ¨tre</td>
</tr>
<tr>
<td><strong>Code gÃ©nÃ©rÃ© qui compile</strong></td>
<td>&gt; 80%</td>
<td>GitHub Actions</td>
</tr>
<tr>
<td><strong>CoÃ»t LLM par jour</strong></td>
<td>&lt; â‚¬10</td>
<td>OpenRouter dashboard</td>
</tr>
<tr>
<td><strong>Temps dev Ã©conomisÃ©</strong></td>
<td>&gt; 50%</td>
<td>Estimation manuelle</td>
</tr>
<tr>
<td><strong>DÃ©ploiements rÃ©ussis</strong></td>
<td>&gt; 90%</td>
<td>GitHub Actions</td>
</tr>
</tbody>
</table>
<h3 id="ce-quon-ne-mesure-pas-en-v1">9.2 Ce quâ€™on ne mesure PAS en
v1</h3>
<ul>
<li>âŒ Latence P95 (pas critique pour POC)</li>
<li>âŒ DisponibilitÃ© 99.9% (pas de SLA)</li>
<li>âŒ MÃ©triques de scaling (mono-instance)</li>
<li>âŒ Security scanning (POC isolÃ©)</li>
</ul>
<hr />
<h2 id="risques-et-mitigations">10. Risques et Mitigations</h2>
<h3 id="risques-principaux-poc-v1">10.1 Risques principaux POC v1</h3>
<table>
<thead>
<tr>
<th>Risque</th>
<th>Impact</th>
<th>Mitigation Simple</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LLM gÃ©nÃ¨re code buguÃ©</strong></td>
<td>Haut</td>
<td>Review manuelle systÃ©matique</td>
</tr>
<tr>
<td><strong>CoÃ»ts OpenRouter</strong></td>
<td>Moyen</td>
<td>Utiliser Ollama par dÃ©faut</td>
</tr>
<tr>
<td><strong>K3s crash</strong></td>
<td>Faible</td>
<td>Backup configs, redÃ©ploiement rapide</td>
</tr>
<tr>
<td><strong>Pipeline trop lent</strong></td>
<td>Moyen</td>
<td>Cache Docker, parallÃ©lisation</td>
</tr>
</tbody>
</table>
<h3 id="risques-acceptÃ©s-pour-v1">10.2 Risques acceptÃ©s pour v1</h3>
<ul>
<li>âœ… Pas de haute disponibilitÃ©</li>
<li>âœ… Secrets en GitHub (pas en production)</li>
<li>âœ… Pas de rollback automatique</li>
<li>âœ… Monitoring minimal</li>
</ul>
<hr />
<h2 id="budget-et-ressources">11. Budget et Ressources</h2>
<h3 id="coÃ»ts-poc-v1-1-mois">11.1 CoÃ»ts POC v1 (1 mois)</h3>
<table>
<thead>
<tr>
<th>Poste</th>
<th>CoÃ»t estimÃ©</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM/Serveur</strong></td>
<td>â‚¬50</td>
<td>1 Ã— 8GB RAM, 4 vCPU</td>
</tr>
<tr>
<td><strong>OpenRouter</strong></td>
<td>â‚¬30</td>
<td>Usage modÃ©rÃ©</td>
</tr>
<tr>
<td><strong>GitHub</strong></td>
<td>â‚¬0</td>
<td>Free tier suffisant</td>
</tr>
<tr>
<td><strong>Domaine</strong></td>
<td>â‚¬0</td>
<td>IP directe pour POC</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>â‚¬80/mois</strong></td>
<td>3Ã— moins que v1 GitOps</td>
</tr>
</tbody>
</table>
<h3 id="temps-humain">11.2 Temps humain</h3>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Jours/homme</th>
<th>CompÃ©tences</th>
</tr>
</thead>
<tbody>
<tr>
<td>Setup infra</td>
<td>1</td>
<td>DevOps junior OK</td>
</tr>
<tr>
<td>Config OpenHands</td>
<td>2</td>
<td>Dev + IA</td>
</tr>
<tr>
<td>Tests &amp; debug</td>
<td>2</td>
<td>Dev</td>
</tr>
<tr>
<td>Documentation</td>
<td>1</td>
<td>Tech writer</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>6 jours</strong></td>
<td>vs 20 jours GitOps</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="critÃ¨res-gono-go-pour-v2">12. CritÃ¨res Go/No-Go pour v2</h2>
<h3 id="passage-en-v2-si">Passage en v2 SI :</h3>
<ul>
<li>âœ… POC gÃ©nÃ¨re &gt;60% code valide</li>
<li>âœ… Ã‰conomie &gt;50% temps dev</li>
<li>âœ… CoÃ»ts LLM &lt;â‚¬200/mois</li>
<li>âœ… Ã‰quipe adhÃ¨re au concept</li>
<li>âœ… Management valide business case</li>
</ul>
<h3 id="alors-v2-ajoutera">Alors v2 ajoutera :</h3>
<ul>
<li>GitOps avec Flux</li>
<li>Monitoring complet</li>
<li>Multi-environnements</li>
<li>Tests automatisÃ©s avancÃ©s</li>
<li>SÃ©curitÃ© renforcÃ©e</li>
</ul>
<hr />
<h2 id="conclusion">13. Conclusion</h2>
<p>Cette approche <strong>DevOps classique simplifiÃ©e</strong> permet de
:</p>
<ol type="1">
<li><strong>Valider rapidement</strong> la valeur ajoutÃ©e dâ€™OpenHands (4
semaines vs 8)</li>
<li><strong>Minimiser la complexitÃ©</strong> technique (push vs
pull)</li>
<li><strong>RÃ©duire les coÃ»ts</strong> initiaux (â‚¬80/mois vs â‚¬250)</li>
<li><strong>Faciliter lâ€™adoption</strong> par lâ€™Ã©quipe (courbe
apprentissage douce)</li>
<li><strong>Garder la flexibilitÃ©</strong> dâ€™Ã©voluer vers GitOps si
succÃ¨s</li>
</ol>
<p><strong>Le focus est mis sur lâ€™innovation IA</strong>, pas sur
lâ€™infrastructure parfaite.</p>
<hr />
<h2 id="annexes">Annexes</h2>
<h3 id="a.-checklist-de-dÃ©marrage-rapide">A. Checklist de dÃ©marrage
rapide</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jour 1 - Infrastructure</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Provisionner VM Ubuntu 22.04</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Installer K3s</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Configurer kubectl local</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> CrÃ©er repo GitHub</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Configurer GitHub Secrets</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jour 2 - LLM Setup  </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> DÃ©ployer Ollama</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Charger modÃ¨les (mistral, llama3)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Tester inference locale</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Configurer OpenRouter (optionnel)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jour 3 - Pipeline</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> CrÃ©er workflow GitHub Actions</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Configurer GHCR</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Premier build/deploy manuel</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> VÃ©rifier pipeline complet</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jour 4 - OpenHands</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Installer OpenHands</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Configurer agents</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Connecter Ã  GitHub</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Premier prompt test</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jour 5 - Integration</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Test gÃ©nÃ©ration code</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Test crÃ©ation PR</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Test dÃ©ploiement auto</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[ ]</span> Documentation</span></code></pre></div>
<h3 id="b.-commandes-utiles">B. Commandes utiles</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Voir les pods</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-A</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Logs d&#39;un pod</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">-f</span> deployment/ollama</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester Ollama</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> http://localhost:11434/api/generate <span class="at">-d</span> <span class="st">&#39;{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;model&quot;: &quot;mistral&quot;,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;prompt&quot;: &quot;Hello world&quot;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># RedÃ©ployer manuellement</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout restart deployment/app</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Voir les events K3s</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get events <span class="at">--sort-by</span><span class="op">=</span><span class="st">&#39;.lastTimestamp&#39;</span></span></code></pre></div>
<h3 id="c.-troubleshooting-rapide">C. Troubleshooting rapide</h3>
<table>
<thead>
<tr>
<th>ProblÃ¨me</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ollama OOM</td>
<td>Augmenter memory limits</td>
</tr>
<tr>
<td>GitHub Actions fail</td>
<td>VÃ©rifier KUBECONFIG secret</td>
</tr>
<tr>
<td>LLM timeout</td>
<td>Augmenter timeout dans config</td>
</tr>
<tr>
<td>Deploy fail</td>
<td><code>kubectl describe pod &lt;pod&gt;</code></td>
</tr>
</tbody>
</table>
<hr />
<p><strong>Document simplifiÃ© pour POC v1</strong><br />
<strong>Approche:</strong> DevOps Classique (Push)<br />
<strong>ComplexitÃ©:</strong> â­â­/5<br />
<strong>Time to Market:</strong> 4 semaines</p>